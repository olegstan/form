{"version":3,"file":"useDateInput.js","names":["_react","require","_moment","_interopRequireDefault","e","__esModule","_slicedToArray","r","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","isSameDateTime","b","getTime","useDateInput","exports","_ref","onChange","_ref$onBlur","onBlur","flatpickrInstance","_ref$setFocused","setFocused","dateFormat","dateMask","formatDate","_ref$setInnerError","setInnerError","_useState","useState","_useState2","date","setDate","_useState3","_useState4","dateString","setDateString","lastEmittedRef","useRef","useEffect","current","emitIfChanged","handleDateChange","selectedDates","handleInputChange","raw","target","trim","parsed","moment","isValid","toDate","console","log","concat","handleBlur"],"sources":["../../../../src/Form/Date/hooks/useDateInput.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\nimport moment from 'moment';\r\n\r\ntype UseDateInputParams = {\r\n    value: Date | null;\r\n    onChange: (v: Date | null) => void;\r\n    onBlur?: () => void;\r\n    flatpickrInstance?: React.MutableRefObject<any>;\r\n    setFocused?: (f: boolean) => void;\r\n    dateFormat: string;      // формат moment (например, 'DD.MM.YYYY')\r\n    dateMask: string;\r\n    formatDate: (date: Date | null, fmt: string) => string;\r\n    setInnerError?: (error: any) => void;\r\n};\r\n\r\nconst isSameDateTime = (a: Date | null, b: Date | null) => {\r\n    if (!a && !b) return true;\r\n    if (!a || !b) return false;\r\n    return a.getTime() === b.getTime();\r\n};\r\n\r\nexport const useDateInput = ({\r\n                                 value,\r\n                                 onChange,\r\n                                 onBlur = () => {},\r\n                                 flatpickrInstance,\r\n                                 setFocused = () => {},\r\n                                 dateFormat,\r\n                                 dateMask,\r\n                                 formatDate,\r\n                                 setInnerError = () => {},\r\n                             }: UseDateInputParams) => {\r\n    const [date, setDate] = useState<Date | null>(value ?? null);\r\n    const [dateString, setDateString] = useState<string>(formatDate(value ?? null, dateFormat));\r\n\r\n    // последнее отданное наружу значение, чтобы не дублировать onChange\r\n    const lastEmittedRef = useRef<Date | null>(value ?? null);\r\n\r\n    // синхронизация при внешнем изменении value\r\n    useEffect(() => {\r\n        if (!isSameDateTime(value ?? null, date)) {\r\n            setDate(value ?? null);\r\n            setDateString(formatDate(value ?? null, dateFormat));\r\n        }\r\n        if (!isSameDateTime(value ?? null, lastEmittedRef.current)) {\r\n            lastEmittedRef.current = value ?? null;\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [value, dateFormat]);\r\n\r\n    const emitIfChanged = (next: Date | null) => {\r\n        if (!isSameDateTime(next, lastEmittedRef.current)) {\r\n            lastEmittedRef.current = next;\r\n            onChange(next);\r\n        }\r\n    };\r\n\r\n    // Клик по календарю / изменение от flatpickr\r\n    const handleDateChange = (selectedDates: Date[]) => {\r\n        const next = selectedDates && selectedDates.length ? selectedDates[0] : null;\r\n\r\n        setDate(next);\r\n        setDateString(formatDate(next, dateFormat));\r\n        setInnerError(false); // было: null\r\n\r\n        emitIfChanged(next);\r\n    };\r\n\r\n    // Ручной ввод\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const raw = e.target.value || '';\r\n        setDateString(raw);\r\n\r\n        if (raw.trim() === '') {\r\n            setDate(null);\r\n            setInnerError(false); // было: null\r\n            emitIfChanged(null);\r\n            return;\r\n        }\r\n\r\n        const parsed = moment(raw, dateFormat, true);\r\n        if (parsed.isValid()) {\r\n            const next = parsed.toDate();\r\n            setDate(next);\r\n            setInnerError(null); // было: null\r\n            emitIfChanged(next);\r\n        } else {\r\n            console.log(`Неверный формат даты: ${raw}`);\r\n        }\r\n    };\r\n\r\n    const handleBlur = () => {\r\n        if (dateString && !moment(dateString, dateFormat, true).isValid()) {\r\n            setDate(null);\r\n            setDateString('');\r\n            setInnerError(false); // было: null\r\n            emitIfChanged(null);\r\n        }\r\n        onBlur?.();\r\n        setFocused(false);\r\n    };\r\n\r\n    return { date, dateString, handleDateChange, handleInputChange, handleBlur, setDateString };\r\n};\r\n"],"mappings":"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","ignoreList":[]}