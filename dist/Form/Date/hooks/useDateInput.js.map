{"version":3,"file":"useDateInput.js","names":["_react","require","_moment","_interopRequireDefault","e","__esModule","_slicedToArray","r","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","a","_arrayLikeToArray","t","toString","call","slice","constructor","name","Array","from","test","length","n","l","Symbol","iterator","i","u","f","o","next","Object","done","push","value","isArray","isValidDate","date","Date","isNaN","getTime","normalizeDate","undefined","parsed","isSameDateTime","b","dateA","dateB","useDateInput","exports","_ref","onChange","_ref$onBlur","onBlur","flatpickrInstance","_ref$setFocused","setFocused","dateFormat","dateMask","formatDate","_ref$setInnerError","setInnerError","normalizedValue","_useState","useState","_useState2","setDate","_useState3","_useState4","dateString","setDateString","lastEmittedRef","useRef","useEffect","current","emitIfChanged","normalizedNext","handleDateChange","selectedDates","handleInputChange","raw","target","trim","moment","isValid","toDate","console","log","concat","handleBlur"],"sources":["../../../../src/Form/Date/hooks/useDateInput.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\r\nimport moment from 'moment';\r\n\r\ntype UseDateInputParams = {\r\n    value: Date | null;\r\n    onChange: (v: Date | null) => void;\r\n    onBlur?: () => void;\r\n    flatpickrInstance?: React.MutableRefObject<any>;\r\n    setFocused?: (f: boolean) => void;\r\n    dateFormat: string;      // формат moment (например, 'DD.MM.YYYY')\r\n    dateMask: string;\r\n    formatDate: (date: Date | null, fmt: string) => string;\r\n    setInnerError?: (error: any) => void;\r\n};\r\n\r\n// Utility function to safely check if a value is a valid Date\r\nconst isValidDate = (date: any): date is Date => {\r\n    return date instanceof Date && !isNaN(date.getTime());\r\n};\r\n\r\n// Utility function to normalize input to Date | null\r\nconst normalizeDate = (value: any): Date | null => {\r\n    if (value === null || value === undefined) {\r\n        return null;\r\n    }\r\n\r\n    if (isValidDate(value)) {\r\n        return value;\r\n    }\r\n\r\n    // If it's a string, try to parse it\r\n    if (typeof value === 'string') {\r\n        const parsed = new Date(value);\r\n        return isValidDate(parsed) ? parsed : null;\r\n    }\r\n\r\n    // For any other type, return null\r\n    return null;\r\n};\r\n\r\nconst isSameDateTime = (a: Date | null, b: Date | null) => {\r\n    // Normalize both inputs\r\n    const dateA = normalizeDate(a);\r\n    const dateB = normalizeDate(b);\r\n\r\n    if (!dateA && !dateB) return true;\r\n    if (!dateA || !dateB) return false;\r\n\r\n    return dateA.getTime() === dateB.getTime();\r\n};\r\n\r\nexport const useDateInput = ({\r\n                                 value,\r\n                                 onChange,\r\n                                 onBlur = () => {},\r\n                                 flatpickrInstance,\r\n                                 setFocused = () => {},\r\n                                 dateFormat,\r\n                                 dateMask,\r\n                                 formatDate,\r\n                                 setInnerError = () => {},\r\n                             }: UseDateInputParams) => {\r\n    // Normalize the initial value\r\n    const normalizedValue = normalizeDate(value);\r\n\r\n    const [date, setDate] = useState<Date | null>(normalizedValue);\r\n    const [dateString, setDateString] = useState<string>(formatDate(normalizedValue, dateFormat));\r\n\r\n    // последнее отданное наружу значение, чтобы не дублировать onChange\r\n    const lastEmittedRef = useRef<Date | null>(normalizedValue);\r\n\r\n    // синхронизация при внешнем изменении value\r\n    useEffect(() => {\r\n        const normalizedValue = normalizeDate(value);\r\n\r\n        if (!isSameDateTime(normalizedValue, date)) {\r\n            setDate(normalizedValue);\r\n            setDateString(formatDate(normalizedValue, dateFormat));\r\n        }\r\n        if (!isSameDateTime(normalizedValue, lastEmittedRef.current)) {\r\n            lastEmittedRef.current = normalizedValue;\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [value, dateFormat]);\r\n\r\n    const emitIfChanged = (next: Date | null) => {\r\n        const normalizedNext = normalizeDate(next);\r\n        if (!isSameDateTime(normalizedNext, lastEmittedRef.current)) {\r\n            lastEmittedRef.current = normalizedNext;\r\n            onChange(normalizedNext);\r\n        }\r\n    };\r\n\r\n    // Клик по календарю / изменение от flatpickr\r\n    const handleDateChange = (selectedDates: Date[]) => {\r\n        const next = selectedDates && selectedDates.length ? normalizeDate(selectedDates[0]) : null;\r\n\r\n        setDate(next);\r\n        setDateString(formatDate(next, dateFormat));\r\n        setInnerError(false);\r\n\r\n        emitIfChanged(next);\r\n    };\r\n\r\n    // Ручной ввод\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const raw = e.target.value || '';\r\n        setDateString(raw);\r\n\r\n        if (raw.trim() === '') {\r\n            setDate(null);\r\n            setInnerError(false);\r\n            emitIfChanged(null);\r\n            return;\r\n        }\r\n\r\n        const parsed = moment(raw, dateFormat, true);\r\n        if (parsed.isValid()) {\r\n            const next = parsed.toDate();\r\n            const normalizedNext = normalizeDate(next);\r\n            setDate(normalizedNext);\r\n            setInnerError(null);\r\n            emitIfChanged(normalizedNext);\r\n        } else {\r\n            console.log(`Неверный формат даты: ${raw}`);\r\n        }\r\n    };\r\n\r\n    const handleBlur = () => {\r\n        if (dateString && !moment(dateString, dateFormat, true).isValid()) {\r\n            setDate(null);\r\n            setDateString('');\r\n            setInnerError(false);\r\n            emitIfChanged(null);\r\n        }\r\n        onBlur?.();\r\n        setFocused(false);\r\n    };\r\n\r\n    return { date, dateString, handleDateChange, handleInputChange, handleBlur, setDateString };\r\n};"],"mappings":"yGAAA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAC,sBAAA,CAAAF,OAAA,YAA4B,SAAAE,uBAAAC,CAAA,UAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,gBAAAA,CAAA,aAAAE,eAAAC,CAAA,EAAAH,CAAA,UAAAI,eAAA,CAAAD,CAAA,KAAAE,qBAAA,CAAAF,CAAA,EAAAH,CAAA,KAAAM,2BAAA,CAAAH,CAAA,EAAAH,CAAA,KAAAO,gBAAA,aAAAA,iBAAA,aAAAC,SAAA,wJAAAF,4BAAAH,CAAA,EAAAM,CAAA,OAAAN,CAAA,0BAAAA,CAAA,SAAAO,iBAAA,CAAAP,CAAA,EAAAM,CAAA,MAAAE,CAAA,MAAAC,QAAA,CAAAC,IAAA,CAAAV,CAAA,EAAAW,KAAA,4BAAAH,CAAA,IAAAR,CAAA,CAAAY,WAAA,KAAAJ,CAAA,GAAAR,CAAA,CAAAY,WAAA,CAAAC,IAAA,aAAAL,CAAA,cAAAA,CAAA,GAAAM,KAAA,CAAAC,IAAA,CAAAf,CAAA,oBAAAQ,CAAA,+CAAAQ,IAAA,CAAAR,CAAA,IAAAD,iBAAA,CAAAP,CAAA,EAAAM,CAAA,sBAAAC,kBAAAP,CAAA,EAAAM,CAAA,YAAAA,CAAA,IAAAA,CAAA,GAAAN,CAAA,CAAAiB,MAAA,MAAAX,CAAA,GAAAN,CAAA,CAAAiB,MAAA,WAAApB,CAAA,MAAAqB,CAAA,GAAAJ,KAAA,CAAAR,CAAA,GAAAT,CAAA,GAAAS,CAAA,EAAAT,CAAA,IAAAqB,CAAA,CAAArB,CAAA,IAAAG,CAAA,CAAAH,CAAA,SAAAqB,CAAA,WAAAhB,sBAAAF,CAAA,EAAAmB,CAAA,OAAAX,CAAA,WAAAR,CAAA,gCAAAoB,MAAA,IAAApB,CAAA,CAAAoB,MAAA,CAAAC,QAAA,KAAArB,CAAA,2BAAAQ,CAAA,OAAAX,CAAA,CAAAqB,CAAA,CAAAI,CAAA,CAAAC,CAAA,CAAAjB,CAAA,MAAAkB,CAAA,MAAAC,CAAA,eAAAH,CAAA,IAAAd,CAAA,GAAAA,CAAA,CAAAE,IAAA,CAAAV,CAAA,GAAA0B,IAAA,QAAAP,CAAA,OAAAQ,MAAA,CAAAnB,CAAA,MAAAA,CAAA,SAAAgB,CAAA,sBAAAA,CAAA,IAAA3B,CAAA,GAAAyB,CAAA,CAAAZ,IAAA,CAAAF,CAAA,GAAAoB,IAAA,MAAAtB,CAAA,CAAAuB,IAAA,CAAAhC,CAAA,CAAAiC,KAAA,GAAAxB,CAAA,CAAAW,MAAA,KAAAE,CAAA,GAAAK,CAAA,gBAAAxB,CAAA,GAAAyB,CAAA,OAAAP,CAAA,GAAAlB,CAAA,sBAAAwB,CAAA,YAAAhB,CAAA,eAAAe,CAAA,GAAAf,CAAA,cAAAmB,MAAA,CAAAJ,CAAA,MAAAA,CAAA,yBAAAE,CAAA,QAAAP,CAAA,UAAAZ,CAAA,YAAAL,gBAAAD,CAAA,OAAAc,KAAA,CAAAiB,OAAA,CAAA/B,CAAA,UAAAA,CAAA;;;;;;;;;;;;;;AAc5B;AACA,IAAMgC,WAAW,GAAG,SAAdA,WAAWA,CAAIC,IAAS,EAAmB;EAC7C,OAAOA,IAAI,YAAYC,IAAI,IAAI,CAACC,KAAK,CAACF,IAAI,CAACG,OAAO,CAAC,CAAC,CAAC;AACzD,CAAC;;AAED;AACA,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAIP,KAAU,EAAkB;EAC/C,IAAIA,KAAK,KAAK,IAAI,IAAIA,KAAK,KAAKQ,SAAS,EAAE;IACvC,OAAO,IAAI;EACf;;EAEA,IAAIN,WAAW,CAACF,KAAK,CAAC,EAAE;IACpB,OAAOA,KAAK;EAChB;;EAEA;EACA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC3B,IAAMS,MAAM,GAAG,IAAIL,IAAI,CAACJ,KAAK,CAAC;IAC9B,OAAOE,WAAW,CAACO,MAAM,CAAC,GAAGA,MAAM,GAAG,IAAI;EAC9C;;EAEA;EACA,OAAO,IAAI;AACf,CAAC;;AAED,IAAMC,cAAc,GAAG,SAAjBA,cAAcA,CAAIlC,CAAc,EAAEmC,CAAc,EAAK;EACvD;EACA,IAAMC,KAAK,GAAGL,aAAa,CAAC/B,CAAC,CAAC;EAC9B,IAAMqC,KAAK,GAAGN,aAAa,CAACI,CAAC,CAAC;;EAE9B,IAAI,CAACC,KAAK,IAAI,CAACC,KAAK,EAAE,OAAO,IAAI;EACjC,IAAI,CAACD,KAAK,IAAI,CAACC,KAAK,EAAE,OAAO,KAAK;;EAElC,OAAOD,KAAK,CAACN,OAAO,CAAC,CAAC,KAAKO,KAAK,CAACP,OAAO,CAAC,CAAC;AAC9C,CAAC;;AAEM,IAAMQ,YAAY,GAAAC,OAAA,CAAAD,YAAA,GAAG,SAAfA,YAAYA,CAAAE,IAAA;;;;;;;;;;AAU8B,KATtBhB,KAAK,GAAAgB,IAAA,CAALhB,KAAK,CACLiB,QAAQ,GAAAD,IAAA,CAARC,QAAQ,CAAAC,WAAA,GAAAF,IAAA,CACRG,MAAM,CAANA,MAAM,GAAAD,WAAA,cAAG,YAAM,CAAC,CAAC,GAAAA,WAAA,CACjBE,iBAAiB,GAAAJ,IAAA,CAAjBI,iBAAiB,CAAAC,eAAA,GAAAL,IAAA,CACjBM,UAAU,CAAVA,UAAU,GAAAD,eAAA,cAAG,YAAM,CAAC,CAAC,GAAAA,eAAA,CACrBE,UAAU,GAAAP,IAAA,CAAVO,UAAU,CACVC,QAAQ,GAAAR,IAAA,CAARQ,QAAQ,CACRC,UAAU,GAAAT,IAAA,CAAVS,UAAU,CAAAC,kBAAA,GAAAV,IAAA,CACVW,aAAa,CAAbA,aAAa,GAAAD,kBAAA,cAAG,YAAM,CAAC,CAAC,GAAAA,kBAAA;EAErD;EACA,IAAME,eAAe,GAAGrB,aAAa,CAACP,KAAK,CAAC;;EAE5C,IAAA6B,SAAA,GAAwB,IAAAC,eAAQ,EAAcF,eAAe,CAAC,CAAAG,UAAA,GAAA9D,cAAA,CAAA4D,SAAA,KAAvD1B,IAAI,GAAA4B,UAAA,IAAEC,OAAO,GAAAD,UAAA;EACpB,IAAAE,UAAA,GAAoC,IAAAH,eAAQ,EAASL,UAAU,CAACG,eAAe,EAAEL,UAAU,CAAC,CAAC,CAAAW,UAAA,GAAAjE,cAAA,CAAAgE,UAAA,KAAtFE,UAAU,GAAAD,UAAA,IAAEE,aAAa,GAAAF,UAAA;;EAEhC;EACA,IAAMG,cAAc,GAAG,IAAAC,aAAM,EAAcV,eAAe,CAAC;;EAE3D;EACA,IAAAW,gBAAS,EAAC,YAAM;IACZ,IAAMX,eAAe,GAAGrB,aAAa,CAACP,KAAK,CAAC;;IAE5C,IAAI,CAACU,cAAc,CAACkB,eAAe,EAAEzB,IAAI,CAAC,EAAE;MACxC6B,OAAO,CAACJ,eAAe,CAAC;MACxBQ,aAAa,CAACX,UAAU,CAACG,eAAe,EAAEL,UAAU,CAAC,CAAC;IAC1D;IACA,IAAI,CAACb,cAAc,CAACkB,eAAe,EAAES,cAAc,CAACG,OAAO,CAAC,EAAE;MAC1DH,cAAc,CAACG,OAAO,GAAGZ,eAAe;IAC5C;IACA;EACJ,CAAC,EAAE,CAAC5B,KAAK,EAAEuB,UAAU,CAAC,CAAC;;EAEvB,IAAMkB,aAAa,GAAG,SAAhBA,aAAaA,CAAI7C,IAAiB,EAAK;IACzC,IAAM8C,cAAc,GAAGnC,aAAa,CAACX,IAAI,CAAC;IAC1C,IAAI,CAACc,cAAc,CAACgC,cAAc,EAAEL,cAAc,CAACG,OAAO,CAAC,EAAE;MACzDH,cAAc,CAACG,OAAO,GAAGE,cAAc;MACvCzB,QAAQ,CAACyB,cAAc,CAAC;IAC5B;EACJ,CAAC;;EAED;EACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIC,aAAqB,EAAK;IAChD,IAAMhD,IAAI,GAAGgD,aAAa,IAAIA,aAAa,CAACzD,MAAM,GAAGoB,aAAa,CAACqC,aAAa,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;;IAE3FZ,OAAO,CAACpC,IAAI,CAAC;IACbwC,aAAa,CAACX,UAAU,CAAC7B,IAAI,EAAE2B,UAAU,CAAC,CAAC;IAC3CI,aAAa,CAAC,KAAK,CAAC;;IAEpBc,aAAa,CAAC7C,IAAI,CAAC;EACvB,CAAC;;EAED;EACA,IAAMiD,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAI9E,CAAsC,EAAK;IAClE,IAAM+E,GAAG,GAAG/E,CAAC,CAACgF,MAAM,CAAC/C,KAAK,IAAI,EAAE;IAChCoC,aAAa,CAACU,GAAG,CAAC;;IAElB,IAAIA,GAAG,CAACE,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;MACnBhB,OAAO,CAAC,IAAI,CAAC;MACbL,aAAa,CAAC,KAAK,CAAC;MACpBc,aAAa,CAAC,IAAI,CAAC;MACnB;IACJ;;IAEA,IAAMhC,MAAM,GAAG,IAAAwC,kBAAM,EAACH,GAAG,EAAEvB,UAAU,EAAE,IAAI,CAAC;IAC5C,IAAId,MAAM,CAACyC,OAAO,CAAC,CAAC,EAAE;MAClB,IAAMtD,IAAI,GAAGa,MAAM,CAAC0C,MAAM,CAAC,CAAC;MAC5B,IAAMT,cAAc,GAAGnC,aAAa,CAACX,IAAI,CAAC;MAC1CoC,OAAO,CAACU,cAAc,CAAC;MACvBf,aAAa,CAAC,IAAI,CAAC;MACnBc,aAAa,CAACC,cAAc,CAAC;IACjC,CAAC,MAAM;MACHU,OAAO,CAACC,GAAG,oHAAAC,MAAA,CAA0BR,GAAG,CAAE,CAAC;IAC/C;EACJ,CAAC;;EAED,IAAMS,UAAU,GAAG,SAAbA,UAAUA,CAAA,EAAS;IACrB,IAAIpB,UAAU,IAAI,CAAC,IAAAc,kBAAM,EAACd,UAAU,EAAEZ,UAAU,EAAE,IAAI,CAAC,CAAC2B,OAAO,CAAC,CAAC,EAAE;MAC/DlB,OAAO,CAAC,IAAI,CAAC;MACbI,aAAa,CAAC,EAAE,CAAC;MACjBT,aAAa,CAAC,KAAK,CAAC;MACpBc,aAAa,CAAC,IAAI,CAAC;IACvB;IACAtB,MAAM,aAANA,MAAM,eAANA,MAAM,CAAG,CAAC;IACVG,UAAU,CAAC,KAAK,CAAC;EACrB,CAAC;;EAED,OAAO,EAAEnB,IAAI,EAAJA,IAAI,EAAEgC,UAAU,EAAVA,UAAU,EAAEQ,gBAAgB,EAAhBA,gBAAgB,EAAEE,iBAAiB,EAAjBA,iBAAiB,EAAEU,UAAU,EAAVA,UAAU,EAAEnB,aAAa,EAAbA,aAAa,CAAC,CAAC;AAC/F,CAAC","ignoreList":[]}